window.requestAnimFrame=window.requestAnimFrame||function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();var km=km||{},_km=_km||{};!function(jQuery){function styleSupport(t){var e,n,i=t.charAt(0).toUpperCase()+t.slice(1),s=["Moz","Webkit","O","ms"],o=document.createElement("div");if(t in o.style)n=t;else{for(var a=0;a<s.length;a++)if(e=s[a]+i,e in o.style){n=e;break}o=null}return $.support[t]=n,n}function randint(t,e){return Math.floor(Math.random()*(e+1-t))+t}function kTransform(){return this.x=0,this.y=0,this.z=0,this.props={},this.props.translate="0,0",this}function getTransition(t,e,n,i){var s=[];$.each(t,function(t){t=$.camelCase(t),t=_km.cssConvTransitionProp[t]||$.cssProps[t]||t,t=unCamelCase(t),-1===$.inArray(t,s)&&s.push(t)}),km.easing[n]&&(n=km.easing[n]);var o=""+toMS(e)+" "+n;parseInt(i,10)>0&&(o+=" "+toMS(i));var a=[];return $.each(s,function(t,e){a.push(e+" "+o)}),a.join(", ")}function unCamelCase(t){return t.replace(RE_UPPER,function(t){return"-"+t.toLowerCase()})}function unit(t,e){return"string"!=typeof t||t.match(RE_NUMBER)?""+t+e:t}function toMS(t){return $.fx.speeds[t]&&(t=$.fx.speeds[t]),unit(t,"ms")}function kSceneState(){return this.id="",this.uid=kSceneCount++,this.old_id="",this}function kScene(t,e){this.onStart=function(){},this.onEnd=function(){},this.dom=_km.loadScene($("<div/>"),e)}var undefined;km.resource_json=km.resource_json||{},km.scene_json=km.scene_json||{},km.imgs=km.imgs||{},km.sounds=km.sounds||{},km.htmls=km.htmls||{},km.scenes=km.scenes||{},km.udid="",km.locale="",km.easing={swing:"cubic-bezier(.02,.01,.47,1)"},km.init=function(t){var e,n=[];for(e in _km.resource_json)_km.resource_json[e].src=km.config.imgpath+_km.resource_json[e].src,n.push(_km.resource_json[e]);if(km.load(n,t),_km.preloads){var i=_km.preloads;_km.preloads=[],km.load(i),i=null}_km.init_f=!0},km.getDeviceInfo=function(){_km.isUIWebView&&_km.hostExec("getdeviceinfo")},km.load=function(url){var a,callback;arguments.length>1?$.isArray(arguments[0])?(a=arguments[0],callback=arguments[1]):a=arguments:a=$.isArray(url)?url:[url];var i,donesrc={};for(i=0;i<a.length;i++){var it={},k,j,filename,obj_f;if(obj_f=!1,"function"==typeof a[i]){callback=a[i];break}if("string"==typeof a[i]){if(a[i]in donesrc)continue;donesrc[a[i]]=!0,it.src=a[i]}else{if("object"!=typeof a[i])break;it=a[i],obj_f=!0}if(/\.(gif|jpe?g|png)$/.test(it.src))new km.Image(it.src);else if(/\.(ogg|mp3|wav)$/.test(it.src))k=it.src.replace(/^(.*\/|)([^\/]+?)\.(ogg|mp3|wav)$/,"$2"),new km.Sound(it.src,it.bpm);else if(/\.kscene$/.test(it.src))$.get(it.src,function(data){eval(data),km.load(_km.preloads),_km.preloads=null,_km.preloads=[]});else if(obj_f)for(k in it)it.hasOwnProperty(k)&&(km.scenes[k]=new kScene(k,it[k]))}var fn=callback;setTimeout(function(){var t;for(t in km.imgs)if(!km.imgs[t].loadok)return setTimeout(arguments.callee,200),void 0;for(t in km.sounds)if(!km.sounds[t].loadok)return setTimeout(arguments.callee,200),void 0;var e={};for(t in km.imgs)e[t]=km.imgs[t];var n=_km.loadResourceCSS(e,"");$('<style type="text/css">'+n+"</style>").appendTo("head"),e=null,fn&&fn()},200)},km.playSound=function(t){if(t in km.sounds)km.sounds[t].play();else{var e=t;t=e.replace(/^(.*\/|)([^\/]+?)\.(mp3|ogg|wav)$/,"$2"),t in km.sounds?km.sounds[t].play():t?new km.Sound(e,function(){this.play()}):console.log(e+" doesn't found")}},km.stopSound=function(t){t in km.sounds?km.sounds[t].stop():t===undefined?$.each(km.sounds,function(t){km.sounds[t].stop()}):(t=t.replace(/^(.*\/|)([^\/]+?)\.(mp3|ogg|wav)$/,"$2"),t in km.sounds&&km.sounds[t].stop())},km.bgm=function(){},km.config={mode3d:!0,swfpath:"ksound.swf",easingPresets:{swing:"cubic-bezier(.02,.01,.47,1)"},defaultEasing:"swing",defaultSceneTransition:"fade",defaultSceneTransitionTime:300},km.beat=400,km.beatCount=0,_km.cssConvTransitionProp={};var ua=navigator.userAgent.toLowerCase();_km.vendor=(navigator.vendor||"").toLowerCase(),_km.isiPhone=/iphone/.test(ua),_km.isiPad=/ipad/.test(ua),_km.isUIWebView=/kmagine/.test(ua),_km.isLocal=!/http/.test(location.href),_km.isAndroid=/android/.test(ua),_km.isTouch="ontouchstart"in window,_km.isIE=ua.match(/msie/i),_km.transition=styleSupport("transition"),_km.transform=styleSupport("transform"),_km.transitionDelay=styleSupport("transitionDelay"),_km.transformOrigin=styleSupport("transformOrigin");var div=document.createElement("div");if(div.style[_km.transform]="",div.style[_km.transform]="rotateY(90deg)",_km.isSupport3d=""!==div.style[_km.transform],div=null,km.toPreset={scaleIn:function(t,e,n){return $(this).to(function(){$(this).show()}).to({opacity:0,scaleX:"+=0.5",scaleY:"+=0.5"}).to({opacity:1,scaleX:"-=0.5",scaleY:"-=0.5"},t||450,e,n)},scaleOut:function(t,e,n){return $(this).to({opacity:1}).to({opacity:0,scaleX:"+=0.5",scaleY:"+=0.5"},t||450,e,n).to(function(){$(this).hide().css({scaleX:"-=0.5",scaleY:"-=0.5"})})},poyo:function(t,e,n){return $(this).to({y:"+=10",scaleY:"-=0.03",scaleX:"+=0.08"}).to({y:"-=10",scaleY:"+=0.03",scaleX:"-=0.08"},t||85,e||"swing",n)},shake:function(t,e,n){var i=5,s=n,o=this,a=t,r=function(){var t=0,e=0,n=function(){var n=randint(0,i)-i/2-t,s=randint(0,i)-i/2-e;t+=n,e+=s,n=n>-1?"+="+n:"-="+-1*n,s=s>-1?"+="+s:"-="+-1*s,$(o).css({x:n,y:s})},r=function(){var n=parseInt($(o).css("x"),10),r=parseInt($(o).css("y"),10);$(o).clearInterval("shake"),$(o).css({x:n-t,y:r-e}),s&&s.apply(o),o=i=s=a=t=e=null};$(o).setInterval("shake",n,26),setTimeout(r,a)};return $(this).to({delay:1},1,r),this}},km.sceneTransitionPresets={none:function(t,e){$(t).destroy(),$(e).css({opacity:1})},fade:function(t,e,n){n/=2;var i=t?n:0;$(t).to({opacity:0},n,"swing",function(){$(this).destroy()}),$(e).to({opacity:1,delay:i},n,"swing")},crossFade:function(t,e,n){$(t).to({opacity:0},n,"swing",function(){$(this).destroy()}),$(e).to({opacity:1},n,"swing")},rotate:function(t,e,n){n/=2;var i=t?n:0;$(t).to({rotateY:90},n,function(){$(this).destory()}),$(e).to({rotateY:-90,opacity:1,delay:i}).to({rotateY:0},n)}},_km.loadScene=function(t,e){function n(t,e){for(var i in e){var s=$("<div/>").css({position:"absolute"}).attr("id",""+i);for(var o in e[i])_km.setValtoObj(s,o,e[i][o]);t.append(s),e[i].children&&n(s,e[i].children)}}var i=t;return n(i,e.children),i},_km.loadResourceCSS=function(t,e){var n=[];e===undefined&&(e=km.config.imgpath);for(var i in t){var s="x"in t[i]?unit(-1*t[i].x,"px"):0,o="y"in t[i]?unit(-1*t[i].y,"px"):0,a="w"in t[i]?unit(t[i].w,"px"):0,r="h"in t[i]?unit(t[i].h,"px"):0,u="src"in t[i]?"background: transparent url("+e+t[i].src+") "+s+" "+o+" no-repeat;":"";n.push([".sp-",i," {",u," width:",a,"; height:",r,";-webkit-transform-style:preserve-3d;transform-style:preserve-3d; }\n"].join(""))}return n.join("")},_km.setValtoObj=function(t,e,n){var i=t;switch(e){case"id":i.attr("id",n);break;case"sprite":i.addClass("sp-"+n);break;case"display":"none"==n&&i.hide();break;case"x":i.css("left",n);break;case"y":i.css("top",n);break;case"z":case"scaleX":case"scaleY":case"opacity":case"overflow":case"rotate":case"rotateX":case"rotateY":case"z-index":i.css(e,n);break;default:return}var s={};s[e]=n,i.data(s)},_km.onbeats=[],km.onBeat=function(t){_km.onBeatFn=t},_km.onBeatFn=function(){},_km.onBeat=function(){var t=Date.now()-km.startTime;console.log(km.beatCount+" time:"+t+" :"+(t-km.beatCount*km.beat));for(var e=_km.onbeats.length,n=0;e>n;n++){var i=_km.onbeats[n],s=$(i).data("kBeat");s?s.call(i,km.beatCount):(_km.onbeats.splice(n,1),n--,e--)}_km.onBeatFn(km.beatCount)},_km.stopBeat=function(){window.clearTimeout(_km.schedulerTimer)},_km.defaultBeat=400,km.nextBeatTime=0,_km.beatQueue=[],_km.scheduler=function(){for(var t=Date.now();km.nextBeatTime<t+200;)_km.beatQueue.push({beat:_km.scheduledBeat,time:km.nextBeatTime}),km.nextBeatTime+=km.beat,_km.scheduledBeat++;_km.schedulerTimer=window.setTimeout(_km.scheduler,50)},km.frame=0,_km.onupdates=[],_km.loopinit=!1,km.onUpdate=function(t){_km.loopinit===!1&&(requestAnimFrame(_km.onUpdate),_km.loopinit=!0),_km.onUpdateFn=t},_km.onUpdateFn=function(){},_km.onUpdate=function(){for(;_km.beatQueue.length&&_km.beatQueue[0].time<Date.now();)km.beatCount++,_km.beatQueue.splice(0,1),_km.onBeat();for(var t=_km.onupdates.length,e=0;t>e;e++){var n=_km.onupdates[e],i=$(n).data("kUpdate");i?i.apply(n):(_km.onupdates.splice(e,1),e--,t--)}km.onUpdate(),km.frame++,requestAnimFrame(_km.onUpdate)},_km.CSSMatrix=window.WebKitCSSMatrix||window.MSCSSMatrix||window.CSSMatrix,!_km.CSSMatrix){var RE_CSSMATRIX=/^.*\((.*)\)$/g,RE_CSSMATRIX_SPLIT=/\s*,\s*/;_km.CSSMatrix=function(t){for(var e=t.replace(RE_CSSMATRIX,"$1").split(RE_CSSMATRIX_SPLIT),n=0;n<e.length;n++)e[n]=parseFloat(e[n]);var i=this;16==e.length?(i.m11=i.a=e[0],i.m12=i.b=e[1],i.m13=e[2],i.m14=e[3],i.m21=i.c=e[4],i.m22=i.d=e[5],i.m23=e[6],i.m24=e[7],i.m31=e[8],i.m32=e[9],i.m33=e[10],i.m34=e[11],i.m41=i.e=e[12],i.m42=i.f=e[13],i.m43=e[14],i.m44=e[15]):6==e.length?(i.m11=i.a=e[0],i.m12=i.b=e[1],i.m13=0,i.m14=0,i.m21=i.c=e[2],i.m22=i.d=e[3],i.m23=0,i.m24=0,i.m41=i.e=e[4],i.m42=i.f=e[5],i.m43=0,i.m44=1):(i.m11=i.a=1,i.m12=i.b=0,i.m13=0,i.m14=0,i.m21=i.c=0,i.m22=i.d=1,i.m23=0,i.m24=0,i.m31=0,i.m32=0,i.m33=1,i.m34=0,i.m41=i.e=0,i.m42=i.f=0,i.m43=0,i.m44=1)}}km.Sound=function(t,e,n){var i=t.replace(/^(.*\/|)([^\/]+?)\.(mp3|ogg|wav)$/,"$2");this.pause_f=!1,this.volume=1,_km.loopinit===!1&&(requestAnimFrame(_km.onUpdate),_km.loopinit=!0),"function"==typeof e&&(n=e,e=0);var s=i.replace(/[^_]+?_([0-9]+?)$/,"$1");s=parseInt(s,10),s&&(e=s),this.bpm=e||0,this.mspb=0!==this.bpm?6e4/e:0,this.loop_f=0!==this.bpm,this.id=i,this.loadok=!1,this.load(i,t,e,n),km.sounds[i]=this},_km.isUIWebView?(km.Sound.prototype={_play:function(){_km.hostExec("soundplay",this.id)},_stop:function(){_km.hostExec("soundstop",this.id)},_pause:function(){_km.hostExec("soundpause",this.id)},load:function(t,e,n,i){var s,o;e.replace(/^(.*\/|)([^\/]+?)\.(mp3|ogg|wav)$/,function(t,e,n,i){s=e+n,o=i}),this.loadComplete=i,_km.hostExec("soundload",[t,"@@",s,"@@",o,"@@",n].join(""))},setLoop:function(t){t===!1?_km.hostExec("setloopfalse",this.id):_km.hostExec("setlooptrue",this.id)},setVolume:function(t){_km.hostExec("setvolume",this.id+"@@"+t)},destroy:function(){this.stop(),_km.hostExec("sounddestroy",this.id),delete km.sounds[this.id]}},_km.kQueue=[],_km.kQueueWait=!1,_km.nextExec=function(){_km.kQueueWait=!1,_km.kQueue.length>0&&(window.location.href=_km.kQueue.shift(),_km.kQueueWait=!0)},_km.hostExec=function(t,e){if(_km.isUIWebView){var n="action://"+t+"/"+e;_km.kQueueWait===!0?_km.kQueue.push(n):(window.location.href=n,_km.kQueueWait=!0)}else _km.isAndroid}):"undefined"!=typeof webkitAudioContext&&_km.isLocal===!1?(_km.audio=new webkitAudioContext,_km.audioout=_km.audio.createGain(),_km.audioout.gain.setValueAtTime(1,0),_km.audioout.connect(_km.audio.destination),km.Sound.prototype={_play:function(){this.pause_f===!0?(this.source.loop=this.loop_f,this.gain.connect(_km.audioout)):(this.source.stop(0),this.source=null,this.source=_km.audio.createBufferSource(),this.source.connect(this.gain),this.source.loop=this.loop_f,this.source.buffer=this.buffer,this.gain.connect(_km.audioout),this.source.start(0))},_pause:function(){this.gain.disconnect(_km.audioout)},_stop:function(){this.source.stop(0)},load:function(t,e,n,i){var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",this.loadComplete=i;var o=this;s.onload=function(){var t=o;_km.audio.decodeAudioData(s.response,function(e){t.buffer=e,t.source=_km.audio.createBufferSource(),t.gain=_km.audio.createGain(),t.source.connect(t.gain),t.gain.gain.setValueAtTime(1,0),t._loadComplete()},function(){console.log("sound load error")})},s.send()},setLoop:function(t){this.loop_f=t,this.source.loop=t},setVolume:function(t){this.volume=t,this.gain.gain.setValueAtTime(t,0)},destroy:function(){this.stop(),this.source.disconnect(this.gain),this.gain.disconnect(_km.audioout),this.buffer=null,this.source=null,this.gain=null,delete km.sounds[this.id]}}):km.Sound.prototype={_play:function(){_km.audiodom.play(this.id)},_pause:function(){_km.audiodom.pause(this.id)},_stop:function(){_km.audiodom.stop(this.id)},setLoop:function(t){this.loop_f=t,_km.audiodom.setLoop(this.id,t)},setVolume:function(t){this.volume=t,_km.audiodom.setVolume(this.id,t)},destroy:function(){this.stop(),_km.audiodom.destroy(this.id),delete km.sounds[this.id]},load:function(t,e,n,i){_km.audiodom||(!function(){if(!_km.audiodom||!_km.audiodom.load){$("#ksound-dom").remove();var t=$("<embed/>").attr({src:km.config.swfpath,name:"ksound-dom",id:"ksound-dom",allowscriptaccess:"always"}).css({position:"absolute",left:-1,top:0,height:1,width:1}).appendTo("body");_km.audiodom=t[0],setTimeout(arguments.callee,2e3)}}(),_km.audiodominit=!0);var s=t,o=e,a=n;setTimeout(function(){!_km.audiodom.load==!1?_km.audiodom.load(s,o,a):setTimeout(arguments.callee,100)},10),this.loadComplete=i}},km.Sound.prototype.play=function(){0!==this.bpm&&(this.pause_f===!1&&(km.beatCount=0),_km.stopBeat(),km.beat=this.mspb,_km.nowbgm&&km.sounds[_km.nowbgm].stop(),_km.nowbgm=this.id),this._play(),0!==this.bpm&&this._startBeat(),this.pause_f=!1},km.Sound.prototype.pause=function(){0!==this.bpm&&(_km.stopBeat(),_km.nowbgm=null),this.pause_f=!0,this._pause()},km.Sound.prototype.stop=function(){0!==this.bpm&&(_km.stopBeat(),_km.nowbgm=null),this._stop(),this.pause_f=!1},km.Sound.prototype._complete=function(){0!==this.bpm&&_km.stopBeat(),this.complete&&this.complete()},km.Sound.prototype._loadComplete=function(){this.loadok=!0,_km.audiodomloadok=!0,this.loadComplete&&this.loadComplete()},km.Sound.prototype._startBeat=function(){_km.loopinit===!1&&(requestAnimFrame(_km.onUpdate),_km.loopinit=!0),km.startTime=Date.now(),_km.scheduledBeat=0,km.nextBeatTime=km.startTime,_km.scheduler()};var customCssProps=["x","y","z","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotate3d","perspective"],prop3d={z:!0,rotateX:!0,rotateY:!0,rotate3d:!0,perspective:!0,transformOrigin:!0};$.each(customCssProps,function(t,e){$.cssHooks[e]={get:function(t){var n=$(t).data("kTransform")||new kTransform,i="get_"+e;return n[i]?n[i]():n.props[e]||0},set:function(t,n){var i,s=$(t).data("kTransform")||new kTransform;""===n?(i="del_"+e,s[i]?s[i]():delete s.props[e]):(i="set_"+e,s[i]?s[i](n):s.props[e]=n.join(",")),t.style[_km.transform]=s.toString(),$(t).data("kTransform",s)}},_km.cssConvTransitionProp[e]=_km.transform,$.cssNumber[e]=!0}),kTransform.prototype={set_rotate:function(t){this.props.rotate=unit(t,"deg")},set_rotateX:function(t){this.props.rotateX=unit(t,"deg")},set_rotateY:function(t){this.props.rotateY=unit(t,"deg")},set_scale:function(t){var e,n;$.isArray(t)?(e=t[0],n=t[1]):e=n=t,this.scaleX=e,this.scaleY=n,this.props.scale=this.scaleX+","+this.scaleY},set_scaleX:function(t){this.scaleX=t,this.scaleY===undefined&&(this.scaleY=1),this.props.scale=this.scaleX+","+this.scaleY},set_scaleY:function(t){this.scaleY=t,this.scaleX===undefined&&(this.scaleX=1),this.props.scale=this.scaleX+","+this.scaleY},set_perspective:function(t){this.props.perspective=unit(t,"px")},set_x:function(t){null!==t&&t!==undefined&&(this.x=t),this.props.translate=unit(this.x,"px")+","+unit(this.y,"px")},set_y:function(t){null!==t&&t!==undefined&&(this.y=t),this.props.translate=unit(this.x,"px")+","+unit(this.y,"px")},set_z:function(t){null!==t&&t!==undefined&&(this.z=t)},get_x:function(){return this.x||0},get_y:function(){return this.y||0},get_z:function(){return this.z||0},get_scale:function(){return this.props.scale?this.scaleX==this.scaleY?this.scaleX:[this.scaleX,this.scaleY]:1},get_scaleX:function(){return this.scaleX||1},get_scaleY:function(){return this.scaleY||1},get_rotate3d:function(){for(var t=(this.props.rotate3d||"0,0,0,0deg").split(","),e=t.length;e--;)t[e]&&(t[e]=parseFloat(t[e]));return t[3]&&(t[3]=unit(t[3],"deg")),t},del_x:function(){this.x=0,this.props.translate=unit(this.x,"px")+","+unit(this.y,"px")},del_y:function(){this.y=0,this.props.translate=unit(this.x,"px")+","+unit(this.y,"px")},del_z:function(){this.z=0},del_scale:function(){delete this.scaleX,delete this.scaleY,delete this.props.scale},toString:function(){var t=[];for(var e in this.props)if(this.props.hasOwnProperty(e))if(_km.isSupport3d)"scale"===e?t.push(e+"3d("+this.props[e]+",1)"):"translate"===e?t.push(e+"3d("+this.props[e]+","+unit(this.z,"px")+")"):"perspective"===e?t.unshift(e+"("+unit(this.props[e],"px")+")"):t.push(e+"("+this.props[e]+")");else{if(e in prop3d)continue;t.push(e+"("+this.props[e]+")")}return t.join(" ")}},$.fn.to=function(t,e,n,i){var s=this,o=0,a=!0;if(this.length>1)return $.each(this,function(){$(this).to(t,e,n,i)}),this;if("string"==typeof t)return km.toPreset[t]?km.toPreset[t].apply(this,[e,n,i]):this;if("function"==typeof t&&(i=t,t={}),$.isArray(t)){for(var r=this,u=0;u<t.length;u++)r=$(r).to(t[u]);return r}"function"==typeof e&&(i=e,e=undefined),"function"==typeof n&&(i=n,n=undefined);var m=$(this).data("kLoop");if(m&&m.rec){var c={};e!==undefined&&(c.duration=e),i!==undefined&&(c.complete=i),n!==undefined&&(c.easing=n),m.log.push($.extend(!0,c,t))}t.complete!==undefined&&(i=t.complete,delete t.complete),t.queue!==undefined&&(a=t.queue,delete t.queue),t.easing!==undefined&&(n=t.easing,delete t.easing),t.delay!==undefined&&(o=t.delay,delete t.delay),t.duration!==undefined&&(e=t.duration,delete t.duration),e===undefined&&(e=0),n===undefined&&(n=km.config.defaultEasing),e=toMS(e);var d=getTransition(t,e,n,o),l=parseInt(e,10)+parseInt(o,10);if(1>l){var p=function(e){s.css(t),"function"==typeof i&&i.apply(s),"function"==typeof e&&e()};return a===!0?s.queue(p):p(),s}var h=function(e){this.offsetWidth;var n=function(){s.css({transition:""}),"function"==typeof i&&i.apply(s),"function"==typeof e&&e()};t.transition=d,s.css(t).setTimeout(n,l)};return a===!0?s.queue(h):h(),s},$.fn.loop=function(){return $.each(this,function(){$(this).data("kLoop",{log:[],rec:!0})}),this},$.fn.endloop=function(){var t=$(this).to(function(){var t=$(this).data("kLoop");if(t&&t.log){for(var e=[],n=0;n<t.log.length;n++)e.push($.extend(!0,{},t.log[n]));$(this).to(e)}},1);return $.each(this,function(){var t=$(this).data("kLoop");t.rec=!1,$(this).data("kLoop",t)}),t},$.fn.stoploop=function(){return $(this).removeData("kLoop"),this};var RE_UPPER=/([A-Z])/g,RE_NUMBER=/^[\-0-9\.]+$/;$.fn.pos=function(t,e,n,i,s){if(0===arguments.length){var o=window.getComputedStyle(this[0])[_km.transform];return o=new _km.CSSMatrix(o),[o.m41,o.m42,o.m43]}return $(this).to({x:t,y:e},n,i,s),this},$.fn.stopTo=function(){var t=window.getComputedStyle(this[0])[_km.transform];this[0].style[_km.transform]=t,this[0].style[_km.transition]=null,t=new _km.CSSMatrix(t);var e=this.data("kTransform");return e.x=t.m41,e.y=t.m42,e.z=t.m43,$(this).queue([]).stop(),this},$.fn.scale=function(t,e,n,i,s){return $(this).to({scaleX:t,scaleY:e},n,i,s),this},$.fn.fhide=function(){return $(this).css("x","+=999"),this},$.fn.fshow=function(){return $(this).css("x","-=999"),this},$.fn.rotate=function(t,e,n,i){return $(this).to({rotate:t},e,n,i),this},$.fn.fade=function(t,e,n,i){return $(this).to({opacity:t},e,n,i),this},$.fn.wait=function(t,e){return $(this).to({delay:t},1,e),this},$.fn.sprite=function(t,e,n){var i=this.data("sprite");if("string"==typeof t)this.removeClass("sp-"+i),this.addClass("sp-"+t);else if($.isArray(t)){var s;for(s=0;s<t.length;s+=2)this.sprite(t[s],t[s+1]);this.to(n)}return this},$.fn.touchClick=function(t){function e(){if(event.touches[0]){var t=event.touches[0];a.id=$(this).get(0),a.x=t.pageX,a.y=t.pageY}event.preventDefault()}function n(t){a.id=$(this).get(0),a.x=t.pageX,a.y=t.pageY}function i(){var t=event.changedTouches[0],e=Math.abs(t.pageX-a.x),n=Math.abs(t.pageY-a.y);a.id==$(this).get(0)&&40>e&&40>n&&o.call(this,t),a.id=null}function s(t){var e=Math.abs(t.pageX-a.x),n=Math.abs(t.pageY-a.y);a.id==$(this).get(0)&&40>e&&40>n&&o.call(this,t),a.id=null}var o=t,a={id:"",x:0,y:0};return _km.isTouch?($(this).on("touchstart",e),$(this).on("touchend",i)):($(this).on("mousedown",n),$(this).on("mouseup",s)),this},$.fn.setTimeout=function(t,e,n){2===arguments.length&&(n=e,e=t,t="");var i=window.setTimeout($.proxy(e,this),n);""===t&&(t=i);var s=$(this).data("kTime")||{};s[t]=i,$(this).data({kTime:s});var o=this,a=t,r=function(){var t=o.data("kTime");t&&t[a]&&delete t[a],o.data({kTime:t})};return window.setTimeout(r,n),this},$.fn.clearTimeout=function(t){var e=$(this).data("kTime");if(t===undefined){for(var n in e)window.clearTimeout(e[n]);$(this).data({kTime:{}})}else e&&t in e&&(window.clearTimeout(e[t]),delete e[t],$(this).data({kTime:e}));return this},$.fn.setInterval=function(t,e,n){2===arguments.length&&(n=e,e=t,t="");var i=$(this).data("kInterval")||{};i[t]&&$(this).clearInterval(t);var s=window.setInterval($.proxy(e,this),n);return""===t&&(t=s),i[t]=s,$(this).data({kInterval:i}),this},$.fn.clearInterval=function(t){var e=$(this).data("kInterval");if(0===arguments.length){var n;for(n in e)clearInterval(e[n]);$(this).data({kInterval:{}})}else e&&t in e&&(clearInterval(e[t]),delete e[t],$(this).data({kInterval:e}));return this},$.fn.onBeat=function(t){return"function"==typeof t?(this.data("kBeat",t),_km.onbeats.push(this)):this.removeData("kBeat"),this},$.fn.destroy=function(){return $(this).contents().andSelf().clearTimeout().clearInterval().stop().attr("id","").stoploop().remove(),this},$.fn.scene=function(t,e,n){var i=$(this).data("kSceneState")||new kSceneState;_km.init_f||km.init(),t in km.scenes||""===t||console.log("not found sceneid:"+t);var s=i.set(this,t,n,e);return $(this).data("kSceneState",i),s};var kSceneCount=0;kSceneState.prototype={set:function(t,e,n,i,s){var o=this.id;if(i=i||km.config.defaultSceneTransitionTime,n=n||km.config.defaultSceneTransition,""!==o){var a=km.scenes[o];a&&a.onDestroy&&a.onDestroy()}var r=$(".js-scene-"+this.uid);$(r).contents().andSelf().attr("id",""),this.id=e,this.old_id=o;var u=null,m={};if(""!==e){var c=$("<div/>").addClass("js-scene-"+this.uid).css({display:"inline",position:"relative",left:0,top:0,width:0,height:0,overflow:"visible"}).prependTo(t);$(t).offset(),u=km.scenes[e].dom.clone(!0),$(u).css({position:"absolute",overflow:"visible",top:0,left:0,"z-index":1e5,opacity:0}).prependTo(c),$(u).find("*").each(function(){var t=$(this).attr("id");m[t]=$(this)});var d=km.scenes[e];d&&d.onStart&&d.onStart()}var l=km.sceneTransitionPresets[n]?km.sceneTransitionPresets[n]:l;return s||""===o?l.apply(this,[null,u,i]):l.apply(this,[r,u,i]),m},get:function(){return this.id},back:function(t,e,n,i){return this.set(t,this.old_id,e,n,i)}},kScene.prototype={},km.Image=function(t){var e;t.replace(/^(.*\/|)([^\/]+?)\.(gif|jpe?g|png)$/,function(t,n,i){e=i}),km.imgs[e]=null,this.e=new Image,this.e.id=e,this.e.src=t,this.src=t,this.e.onload=function(){var t=this.id;km.imgs[t].w=this.width,km.imgs[t].h=this.height,km.imgs[t].loadok=!0},km.imgs[e]=this},km.Image.prototype={createDOM:function(){var t=document.createElement("div");return t.className=this.className,t}}}(jQuery);